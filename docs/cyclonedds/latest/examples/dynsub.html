
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>dynsub &#8212; Eclipse Cyclone DDS 0.11.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic_mod.css?v=0.7.0-1" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="/_static/css/helpers.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="/_static/js/helpers.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/petite-vue.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DDS Security" href="../security.html" />
    <link rel="prev" title="listtopics" href="listtopics.html" /> 
  </head><body>

<div id="top_nav">
    

    <nav>
        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="../index.html" title="Go to homepage">Eclipse Cyclone DDS 0.11.0 documentation</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="../search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">Configuration Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="helloworld.html">HelloWorld</a></li>
<li class="toctree-l2"><a class="reference internal" href="roundtrip.html">Roundtrip</a></li>
<li class="toctree-l2"><a class="reference internal" href="throughput.html">Throughput</a></li>
<li class="toctree-l2"><a class="reference internal" href="listtopics.html">listtopics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">dynsub</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">DDS Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shared_memory.html">Shared Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ddsc.html">C API Reference</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="dynsub">
<h1>dynsub<a class="headerlink" href="#dynsub" title="Permalink to this headline">¶</a></h1>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The “dynsub” example is a PoC for a C-based JSON printer for arbitrary data. It assumes
that topic discovery is enabled, but doesn’t require it.</p>
</section>
<section id="running-the-example">
<h2>Running the example<a class="headerlink" href="#running-the-example" title="Permalink to this headline">¶</a></h2>
<p>Pass it the name of a topic and it will wait for some time for a writer of that topic to
show up.  Once it finds on in the DCPSPublication topic, it then tries to subscribe and
print the received samples as JSON.</p>
<p>It is far from complete and definitely buggy.  It is just a PoC!</p>
<p>For example: start the HelloworldPublisher in one shell:</p>
<blockquote>
<div><p># bin/HelloworldPublisher
=== [Publisher]  Waiting for a reader to be discovered …</p>
</div></blockquote>
<p>then in another shell start this program:</p>
<blockquote>
<div><p># bin/dynsub HelloWorldData_Msg
{“userID”:1,”message”:”Hello World”}
{“userID”:1}</p>
</div></blockquote>
<p>The second line is the “invalid sample” generated because of the termination of the
publisher.  In Cyclone DDS that means only the key fields are valid and so that is what
gets printed.</p>
<p>There is a small publisher program “variouspub” that can publish a number of different
types to make things a bit more interesting than HelloWorldData_Msg.  Pass it the name of
the type to publish, like:</p>
<blockquote>
<div><p># bin/variouspub B</p>
</div></blockquote>
<p>This will publish samples at 1Hz until killed.</p>
</section>
<section id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">dynsub.c</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>#include &lt;stdio.h&gt;
<span class="linenos">  2</span>#include &lt;string.h&gt;
<span class="linenos">  3</span>#include &lt;stdlib.h&gt;
<span class="linenos">  4</span>#include &lt;assert.h&gt;
<span class="linenos">  5</span>
<span class="linenos">  6</span>#include &quot;dds/dds.h&quot;
<span class="linenos">  7</span>
<span class="linenos">  8</span>// Interpreting the data of an arbitrary topic requires interpreting the type object that describes the data.
<span class="linenos">  9</span>// The type object type is defined by the XTypes specification (https://www.omg.org/spec/DDS-XTypes/) and it
<span class="linenos"> 10</span>// comes in two forms: MinimalTypeObject and CompleteTypeObject.  Only the latter includes field names, so
<span class="linenos"> 11</span>// that&#39;s what need.
<span class="linenos"> 12</span>//
<span class="linenos"> 13</span>// Cyclone DDS includes a copy of the IDL as well as the corresponding type definitions in C as generated by
<span class="linenos"> 14</span>// IDLC.  So instead of including yet another copy, we simply refer to those.  These files are not (yet?)
<span class="linenos"> 15</span>// part of the stable API of Cyclone DDS and so the updates to Cyclone may change the locations or the names
<span class="linenos"> 16</span>// of the relevant header files.
<span class="linenos"> 17</span>//
<span class="linenos"> 18</span>// The API uses `dds_typeobj_t` and `dds_typeinfo_t` that are opaque types but really amount to the
<span class="linenos"> 19</span>// corresponding XTypes objects: DDS_XTypes_TypeObject and DDS_XTypes_TypeInformation.  Rather than casting
<span class="linenos"> 20</span>// pointers like we do here, they should be defined in a slightly different way so that they are not really
<span class="linenos"> 21</span>// opaque.  For now, this&#39;ll have to do.
<span class="linenos"> 22</span>#include &quot;dds/ddsi/ddsi_xt_typeinfo.h&quot;
<span class="linenos"> 23</span>
<span class="linenos"> 24</span>// TypeObjects can (and often do) refer to other types via an opaque id.  We don&#39;t want to have to request
<span class="linenos"> 25</span>// the corresponding type object every time we need it (it can be quite costly) and so have cache them in
<span class="linenos"> 26</span>// our own hash table.  For the hash table implementation we use one that&#39;s part of the implementation of
<span class="linenos"> 27</span>// Cyclone DDS.  It is *not* part of the API, it is simply a convenient solution for a simple PoC.
<span class="linenos"> 28</span>#include &quot;dds/ddsrt/hopscotch.h&quot;
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>// Entry in type cache hash table: it not only caches type objects, it also caches alignment and size of
<span class="linenos"> 31</span>// the in-memory representation of any structure types.  These we need to get the alignment calculations
<span class="linenos"> 32</span>// correct.
<span class="linenos"> 33</span>struct typeinfo {
<span class="linenos"> 34</span>  union {
<span class="linenos"> 35</span>    uintptr_t key; // DDS_XTypes_CompleteTypeObject or DDS_XTypes_TypeIdentifier pointer
<span class="linenos"> 36</span>    uint32_t u32[sizeof (uintptr_t) / 4];
<span class="linenos"> 37</span>  } key;
<span class="linenos"> 38</span>  const DDS_XTypes_CompleteTypeObject *typeobj; // complete type object for type T
<span class="linenos"> 39</span>  const DDS_XTypes_TypeObject *release; // type object to release, or NULL if nothing
<span class="linenos"> 40</span>  size_t align; // _Alignof(T)
<span class="linenos"> 41</span>  size_t size; // sizeof(T)
<span class="linenos"> 42</span>};
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>// For convenience, the DDS participant and the type cache are globals
<span class="linenos"> 45</span>static dds_entity_t participant;
<span class="linenos"> 46</span>static struct ddsrt_hh *typecache;
<span class="linenos"> 47</span>
<span class="linenos"> 48</span>// Hash table requires a hash function and an equality test.  The key in the hash table is the address
<span class="linenos"> 49</span>// of the type object or type identifier.  The hash function distinguishes between 32-bit and 64-bit
<span class="linenos"> 50</span>// pointers, the equality test can simply use pointer equality.
<span class="linenos"> 51</span>static uint32_t typecache_hash (const void *vinfo)
<span class="linenos"> 52</span>{
<span class="linenos"> 53</span>  const struct typeinfo *info = vinfo;
<span class="linenos"> 54</span>  if (sizeof (uintptr_t) == 4)
<span class="linenos"> 55</span>    return (uint32_t) (((info-&gt;key.u32[0] + UINT64_C (16292676669999574021)) * UINT64_C (10242350189706880077)) &gt;&gt; 32);
<span class="linenos"> 56</span>  else
<span class="linenos"> 57</span>    return (uint32_t) (((info-&gt;key.u32[0] + UINT64_C (16292676669999574021)) * (info-&gt;key.u32[1] + UINT64_C (10242350189706880077))) &gt;&gt; 32);
<span class="linenos"> 58</span>}
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>static int typecache_equal (const void *va, const void *vb)
<span class="linenos"> 61</span>{
<span class="linenos"> 62</span>  const struct typeinfo *a = va;
<span class="linenos"> 63</span>  const struct typeinfo *b = vb;
<span class="linenos"> 64</span>  return a-&gt;key.key == b-&gt;key.key;
<span class="linenos"> 65</span>}
<span class="linenos"> 66</span>
<span class="linenos"> 67</span>// Building the type cache: the TypeObjects come in a variety of formats (see the spec for the details,
<span class="linenos"> 68</span>// much is omitted here for simplicity), but it comes down to:
<span class="linenos"> 69</span>// - a TypeObject describing a &quot;simple&quot; type
<span class="linenos"> 70</span>// - a TypeObject describing any other type
<span class="linenos"> 71</span>// - a TypeIdentifier that actually is a &quot;simple&quot; type
<span class="linenos"> 72</span>// - a TypeIdentifier that references some type
<span class="linenos"> 73</span>// The two &quot;simple&quot; types can be factored out, resulting in a function for computing alignment and
<span class="linenos"> 74</span>// sizeof for a simple type and functions for the other cases when it turns out not to be a simple
<span class="linenos"> 75</span>// case.
<span class="linenos"> 76</span>//
<span class="linenos"> 77</span>// Beware that a lot of cases are missing!
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>static void build_typecache_to (const DDS_XTypes_CompleteTypeObject *typeobj, size_t *align, size_t *size);
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>static bool build_typecache_simple (const uint8_t disc, size_t *align, size_t *size)
<span class="linenos"> 82</span>{
<span class="linenos"> 83</span>  switch (disc)
<span class="linenos"> 84</span>  {
<span class="linenos"> 85</span>#define CASE(disc, type) DDS_XTypes_TK_##disc: *align = _Alignof(type); *size = sizeof(type); return true
<span class="linenos"> 86</span>    case CASE(BOOLEAN, uint8_t);
<span class="linenos"> 87</span>    case CASE(CHAR8, int8_t);
<span class="linenos"> 88</span>    case CASE(INT16, int16_t);
<span class="linenos"> 89</span>    case CASE(INT32, int32_t);
<span class="linenos"> 90</span>    case CASE(INT64, int64_t);
<span class="linenos"> 91</span>    case CASE(BYTE, uint8_t);
<span class="linenos"> 92</span>    case CASE(UINT16, uint16_t);
<span class="linenos"> 93</span>    case CASE(UINT32, uint32_t);
<span class="linenos"> 94</span>    case CASE(UINT64, uint64_t);
<span class="linenos"> 95</span>    case CASE(FLOAT32, float);
<span class="linenos"> 96</span>    case CASE(FLOAT64, double);
<span class="linenos"> 97</span>    case CASE(STRING8, char *);
<span class="linenos"> 98</span>#undef CASE
<span class="linenos"> 99</span>  }
<span class="linenos">100</span>  return false;
<span class="linenos">101</span>}
<span class="linenos">102</span>
<span class="linenos">103</span>static void build_typecache_ti (const DDS_XTypes_TypeIdentifier *typeid, size_t *align, size_t *size)
<span class="linenos">104</span>{
<span class="linenos">105</span>  if (build_typecache_simple (typeid-&gt;_d, align, size))
<span class="linenos">106</span>    return;
<span class="linenos">107</span>  switch (typeid-&gt;_d)
<span class="linenos">108</span>  {
<span class="linenos">109</span>    case DDS_XTypes_TI_STRING8_SMALL:
<span class="linenos">110</span>    case DDS_XTypes_TI_STRING8_LARGE:
<span class="linenos">111</span>      *align = _Alignof (char *); *size = sizeof (char *);
<span class="linenos">112</span>      break;
<span class="linenos">113</span>    case DDS_XTypes_TI_PLAIN_SEQUENCE_SMALL:
<span class="linenos">114</span>    case DDS_XTypes_TI_PLAIN_SEQUENCE_LARGE: {
<span class="linenos">115</span>      const DDS_XTypes_TypeIdentifier *et = (typeid-&gt;_d == DDS_XTypes_TI_PLAIN_SEQUENCE_SMALL) ? typeid-&gt;_u.seq_sdefn.element_identifier : typeid-&gt;_u.seq_ldefn.element_identifier;
<span class="linenos">116</span>      size_t a, s;
<span class="linenos">117</span>      build_typecache_ti (et, &amp;a, &amp;s);
<span class="linenos">118</span>      *align = _Alignof (dds_sequence_t); *size = sizeof (dds_sequence_t);
<span class="linenos">119</span>      break;
<span class="linenos">120</span>    }
<span class="linenos">121</span>    case DDS_XTypes_EK_COMPLETE: {
<span class="linenos">122</span>      struct typeinfo templ = { .key = { .key = (uintptr_t) typeid } }, *info;
<span class="linenos">123</span>      if ((info = ddsrt_hh_lookup (typecache, &amp;templ)) != NULL) {
<span class="linenos">124</span>        *align = info-&gt;align;
<span class="linenos">125</span>        *size = info-&gt;size;
<span class="linenos">126</span>      } else {
<span class="linenos">127</span>        dds_typeobj_t *typeobj;
<span class="linenos">128</span>        if (dds_get_typeobj (participant, (const dds_typeid_t *) typeid, 0, &amp;typeobj) &lt; 0)
<span class="linenos">129</span>          abort ();
<span class="linenos">130</span>        DDS_XTypes_TypeObject * const xtypeobj = (DDS_XTypes_TypeObject *) typeobj;
<span class="linenos">131</span>        build_typecache_to (&amp;xtypeobj-&gt;_u.complete, align, size);
<span class="linenos">132</span>        info = malloc (sizeof (*info));
<span class="linenos">133</span>        *info = (struct typeinfo){ .key = { .key = (uintptr_t) typeid }, .typeobj = &amp;xtypeobj-&gt;_u.complete, .release = xtypeobj, .align = *align, .size = *size };
<span class="linenos">134</span>        ddsrt_hh_add (typecache, info);
<span class="linenos">135</span>      }
<span class="linenos">136</span>      break;
<span class="linenos">137</span>    }
<span class="linenos">138</span>    default:
<span class="linenos">139</span>      printf (&quot;type id discriminant %u encountered, sorry\n&quot;, (unsigned) typeid-&gt;_d);
<span class="linenos">140</span>      abort ();
<span class="linenos">141</span>  }
<span class="linenos">142</span>}
<span class="linenos">143</span>
<span class="linenos">144</span>static void build_typecache_to (const DDS_XTypes_CompleteTypeObject *typeobj, size_t *align, size_t *size)
<span class="linenos">145</span>{
<span class="linenos">146</span>  if (build_typecache_simple (typeobj-&gt;_d, size, align))
<span class="linenos">147</span>    return;
<span class="linenos">148</span>  switch (typeobj-&gt;_d)
<span class="linenos">149</span>  {
<span class="linenos">150</span>    case DDS_XTypes_TK_SEQUENCE: {
<span class="linenos">151</span>      const DDS_XTypes_TypeIdentifier *et = &amp;typeobj-&gt;_u.sequence_type.element.common.type;
<span class="linenos">152</span>      size_t a, s;
<span class="linenos">153</span>      build_typecache_ti (et, &amp;a, &amp;s);
<span class="linenos">154</span>      *align = _Alignof (dds_sequence_t); *size = sizeof (dds_sequence_t);
<span class="linenos">155</span>      break;
<span class="linenos">156</span>    }
<span class="linenos">157</span>    case DDS_XTypes_TK_STRUCTURE: {
<span class="linenos">158</span>      struct typeinfo templ = { .key = { .key = (uintptr_t) typeobj } }, *info;
<span class="linenos">159</span>      if ((info = ddsrt_hh_lookup (typecache, &amp;templ)) != NULL) {
<span class="linenos">160</span>        *align = info-&gt;align;
<span class="linenos">161</span>        *size = info-&gt;size;
<span class="linenos">162</span>      } else {
<span class="linenos">163</span>        const DDS_XTypes_CompleteStructType *t = &amp;typeobj-&gt;_u.struct_type;
<span class="linenos">164</span>        *align = 1; *size = 0;
<span class="linenos">165</span>        for (uint32_t i = 0; i &lt; t-&gt;member_seq._length; i++)
<span class="linenos">166</span>        {
<span class="linenos">167</span>          const DDS_XTypes_CompleteStructMember *m = &amp;t-&gt;member_seq._buffer[i];
<span class="linenos">168</span>          size_t a, s;
<span class="linenos">169</span>          build_typecache_ti (&amp;m-&gt;common.member_type_id, &amp;a, &amp;s);
<span class="linenos">170</span>          if (a &gt; *align)
<span class="linenos">171</span>            *align = a;
<span class="linenos">172</span>          if (*size % a)
<span class="linenos">173</span>            *size += a - (*size % a);
<span class="linenos">174</span>          *size += s;
<span class="linenos">175</span>        }
<span class="linenos">176</span>        if (*size % *align)
<span class="linenos">177</span>          *size += *align - (*size % *align);
<span class="linenos">178</span>        info = malloc (sizeof (*info));
<span class="linenos">179</span>        *info = (struct typeinfo){ .key = { .key = (uintptr_t) typeobj }, .typeobj = typeobj, .release = NULL, .align = *align, .size = *size };
<span class="linenos">180</span>        ddsrt_hh_add (typecache, info);
<span class="linenos">181</span>      }
<span class="linenos">182</span>      break;
<span class="linenos">183</span>    }
<span class="linenos">184</span>    default: {
<span class="linenos">185</span>      printf (&quot;type object discriminant %u encountered, sorry\n&quot;, (unsigned) typeobj-&gt;_d);
<span class="linenos">186</span>      abort ();
<span class="linenos">187</span>    }
<span class="linenos">188</span>  }
<span class="linenos">189</span>}
<span class="linenos">190</span>
<span class="linenos">191</span>static void free_typeinfo (void *vinfo, void *varg)
<span class="linenos">192</span>{
<span class="linenos">193</span>  struct typeinfo *info = vinfo;
<span class="linenos">194</span>  (void) varg;
<span class="linenos">195</span>  if (info-&gt;release)
<span class="linenos">196</span>    dds_free_typeobj ((dds_typeobj_t *) info-&gt;release);
<span class="linenos">197</span>  free (info);
<span class="linenos">198</span>}
<span class="linenos">199</span>
<span class="linenos">200</span>// Printing JSON: the TypeObject/TypeIdentifier handling follows the pattern used for building the type cache,
<span class="linenos">201</span>// except now it just looks up entries in the cache (that are always present).  We do pass a bit of context:
<span class="linenos">202</span>// - whether the sample is a &quot;valid sample&quot;, that is: whether all fields are valid, or only the key fields
<span class="linenos">203</span>// - whether all fields in the path from the top-level had the &quot;key&quot; annotation set, because only in that case
<span class="linenos">204</span>//   is the field actually a key field
<span class="linenos">205</span>// The trouble with skipping non-key fields is that we still need to go over them to compute the offset of the
<span class="linenos">206</span>// key fields that follow it.  Of course it would be possible to store more information in the type cache, but
<span class="linenos">207</span>// that is left as an exercise to the reader.
<span class="linenos">208</span>
<span class="linenos">209</span>struct context {
<span class="linenos">210</span>  bool valid_data;
<span class="linenos">211</span>  bool key;
<span class="linenos">212</span>  size_t offset;
<span class="linenos">213</span>  size_t maxalign;
<span class="linenos">214</span>};
<span class="linenos">215</span>
<span class="linenos">216</span>static const void *align (const unsigned char *base, struct context *c, size_t align, size_t size)
<span class="linenos">217</span>{
<span class="linenos">218</span>  if (align &gt; c-&gt;maxalign)
<span class="linenos">219</span>    c-&gt;maxalign = align;
<span class="linenos">220</span>  if (c-&gt;offset % align)
<span class="linenos">221</span>    c-&gt;offset += align - (c-&gt;offset % align);
<span class="linenos">222</span>  const size_t o = c-&gt;offset;
<span class="linenos">223</span>  c-&gt;offset += size;
<span class="linenos">224</span>  return base + o;
<span class="linenos">225</span>}
<span class="linenos">226</span>
<span class="linenos">227</span>static void print_sample1_to (const unsigned char *sample, const DDS_XTypes_CompleteTypeObject *typeobj, struct context *c, const char *sep, const char *label);
<span class="linenos">228</span>
<span class="linenos">229</span>static bool print_sample1_simple (const unsigned char *sample, const uint8_t disc, struct context *c, const char *sep, const char *label)
<span class="linenos">230</span>{
<span class="linenos">231</span>  switch (disc)
<span class="linenos">232</span>  {
<span class="linenos">233</span>#define CASE(disc, type, fmt) DDS_XTypes_TK_##disc: { \
<span class="linenos">234</span>    const type *p = (const type *) align (sample, c, _Alignof(type), sizeof(type)); \
<span class="linenos">235</span>    if (c-&gt;key || c-&gt;valid_data) { printf (&quot;%s&quot;, sep); if (label) printf (&quot;\&quot;%s\&quot;:&quot;, label); fmt; } \
<span class="linenos">236</span>    return true; \
<span class="linenos">237</span>  }
<span class="linenos">238</span>    case CASE(BOOLEAN, uint8_t, printf (&quot;%s&quot;, *p ? &quot;true&quot; : &quot;false&quot;));
<span class="linenos">239</span>    case CASE(CHAR8, int8_t, printf (&quot;\&quot;%c\&quot;&quot;, (char) *p));
<span class="linenos">240</span>    case CASE(INT16, int16_t, printf (&quot;%&quot;PRId16, *p));
<span class="linenos">241</span>    case CASE(INT32, int32_t, printf (&quot;%&quot;PRId32, *p));
<span class="linenos">242</span>    case CASE(INT64, int64_t, printf (&quot;%&quot;PRId64, *p));
<span class="linenos">243</span>    case CASE(BYTE, uint8_t, printf (&quot;%&quot;PRIu8, *p));
<span class="linenos">244</span>    case CASE(UINT16, uint16_t, printf (&quot;%&quot;PRIu16, *p));
<span class="linenos">245</span>    case CASE(UINT32, uint32_t, printf (&quot;%&quot;PRIu32, *p));
<span class="linenos">246</span>    case CASE(UINT64, uint64_t, printf (&quot;%&quot;PRIu64, *p));
<span class="linenos">247</span>    case CASE(FLOAT32, float, printf (&quot;%f&quot;, *p));
<span class="linenos">248</span>    case CASE(FLOAT64, double, printf (&quot;%f&quot;, *p));
<span class="linenos">249</span>    case CASE(STRING8, char *, printf (&quot;\&quot;%s\&quot;&quot;, *p));
<span class="linenos">250</span>#undef CASE
<span class="linenos">251</span>  }
<span class="linenos">252</span>  return false;
<span class="linenos">253</span>}
<span class="linenos">254</span>
<span class="linenos">255</span>static void print_sample1_ti (const unsigned char *sample, const DDS_XTypes_TypeIdentifier *typeid, struct context *c, const char *sep, const char *label)
<span class="linenos">256</span>{
<span class="linenos">257</span>  if (print_sample1_simple (sample, typeid-&gt;_d, c, sep, label))
<span class="linenos">258</span>    return;
<span class="linenos">259</span>  switch (typeid-&gt;_d)
<span class="linenos">260</span>  {
<span class="linenos">261</span>    case DDS_XTypes_TI_STRING8_SMALL:
<span class="linenos">262</span>    case DDS_XTypes_TI_STRING8_LARGE: {
<span class="linenos">263</span>      const char **p = (const char **) align (sample, c, _Alignof (char *), sizeof (char *));
<span class="linenos">264</span>      if (c-&gt;key || c-&gt;valid_data)
<span class="linenos">265</span>      {
<span class="linenos">266</span>        printf (&quot;%s&quot;, sep);
<span class="linenos">267</span>        if (label) printf (&quot;\&quot;%s\&quot;:&quot;, label);
<span class="linenos">268</span>        printf (&quot;\&quot;%s\&quot;&quot;, *p);
<span class="linenos">269</span>      }
<span class="linenos">270</span>      break;
<span class="linenos">271</span>    }
<span class="linenos">272</span>    case DDS_XTypes_TI_PLAIN_SEQUENCE_SMALL:
<span class="linenos">273</span>    case DDS_XTypes_TI_PLAIN_SEQUENCE_LARGE: {
<span class="linenos">274</span>      const DDS_XTypes_TypeIdentifier *et = (typeid-&gt;_d == DDS_XTypes_TI_PLAIN_SEQUENCE_SMALL) ? typeid-&gt;_u.seq_sdefn.element_identifier : typeid-&gt;_u.seq_ldefn.element_identifier;
<span class="linenos">275</span>      const dds_sequence_t *p = align (sample, c, _Alignof (dds_sequence_t), sizeof (dds_sequence_t));
<span class="linenos">276</span>      if (c-&gt;key || c-&gt;valid_data)
<span class="linenos">277</span>      {
<span class="linenos">278</span>        struct context c1 = *c; c1.offset = 0; c1.maxalign = 1;
<span class="linenos">279</span>        printf (&quot;%s&quot;, sep);
<span class="linenos">280</span>        if (label) printf (&quot;\&quot;%s\&quot;:&quot;, label);
<span class="linenos">281</span>        printf (&quot;[&quot;);
<span class="linenos">282</span>        sep = &quot;&quot;;
<span class="linenos">283</span>        for (uint32_t i = 0; i &lt; p-&gt;_length; i++)
<span class="linenos">284</span>        {
<span class="linenos">285</span>          print_sample1_ti (p-&gt;_buffer, et, &amp;c1, sep, NULL);
<span class="linenos">286</span>          sep = &quot;,&quot;;
<span class="linenos">287</span>        }
<span class="linenos">288</span>        printf (&quot;]&quot;);
<span class="linenos">289</span>      }
<span class="linenos">290</span>      break;
<span class="linenos">291</span>    }
<span class="linenos">292</span>    case DDS_XTypes_EK_COMPLETE: {
<span class="linenos">293</span>      struct typeinfo templ = { .key = { .key = (uintptr_t) typeid } }, *info = ddsrt_hh_lookup (typecache, &amp;templ);
<span class="linenos">294</span>      print_sample1_to (sample, info-&gt;typeobj, c, sep, label);
<span class="linenos">295</span>      break;
<span class="linenos">296</span>    }
<span class="linenos">297</span>  }
<span class="linenos">298</span>}
<span class="linenos">299</span>
<span class="linenos">300</span>static void print_sample1_to (const unsigned char *sample, const DDS_XTypes_CompleteTypeObject *typeobj, struct context *c, const char *sep, const char *label)
<span class="linenos">301</span>{
<span class="linenos">302</span>  if (print_sample1_simple (sample, typeobj-&gt;_d, c, sep, label))
<span class="linenos">303</span>    return;
<span class="linenos">304</span>  switch (typeobj-&gt;_d)
<span class="linenos">305</span>  {
<span class="linenos">306</span>    case DDS_XTypes_TK_SEQUENCE: {
<span class="linenos">307</span>      const DDS_XTypes_TypeIdentifier *et = &amp;typeobj-&gt;_u.sequence_type.element.common.type;
<span class="linenos">308</span>      const dds_sequence_t *p = align (sample, c, _Alignof (dds_sequence_t), sizeof (dds_sequence_t));
<span class="linenos">309</span>      struct context c1 = *c; c1.offset = 0; c1.maxalign = 1;
<span class="linenos">310</span>      printf (&quot;%s&quot;, sep);
<span class="linenos">311</span>      if (label) printf (&quot;\&quot;%s\&quot;:&quot;, label);
<span class="linenos">312</span>      printf (&quot;[&quot;);
<span class="linenos">313</span>      sep = &quot;&quot;;
<span class="linenos">314</span>      for (uint32_t i = 0; i &lt; p-&gt;_length; i++)
<span class="linenos">315</span>      {
<span class="linenos">316</span>        print_sample1_ti ((const unsigned char *) p-&gt;_buffer, et, &amp;c1, sep, NULL);
<span class="linenos">317</span>        sep = &quot;,&quot;;
<span class="linenos">318</span>        if (c1.offset % c1.maxalign)
<span class="linenos">319</span>          c1.offset += c1.maxalign - (c1.offset % c1.maxalign);
<span class="linenos">320</span>      }
<span class="linenos">321</span>      printf (&quot;]&quot;);
<span class="linenos">322</span>      break;
<span class="linenos">323</span>    }
<span class="linenos">324</span>    case DDS_XTypes_TK_STRUCTURE: {
<span class="linenos">325</span>      struct typeinfo templ = { .key = { .key = (uintptr_t) typeobj } }, *info = ddsrt_hh_lookup (typecache, &amp;templ);
<span class="linenos">326</span>      const DDS_XTypes_CompleteStructType *t = &amp;typeobj-&gt;_u.struct_type;
<span class="linenos">327</span>      const unsigned char *p = align (sample, c, info-&gt;align, info-&gt;size);;
<span class="linenos">328</span>      printf (&quot;%s&quot;, sep);
<span class="linenos">329</span>      if (label) printf (&quot;\&quot;%s\&quot;:&quot;, label);
<span class="linenos">330</span>      printf (&quot;{&quot;);
<span class="linenos">331</span>      sep = &quot;&quot;;
<span class="linenos">332</span>      struct context c1 = *c; c1.offset = 0; c1.maxalign = 1;
<span class="linenos">333</span>      for (uint32_t i = 0; i &lt; t-&gt;member_seq._length; i++)
<span class="linenos">334</span>      {
<span class="linenos">335</span>        const DDS_XTypes_CompleteStructMember *m = &amp;t-&gt;member_seq._buffer[i];
<span class="linenos">336</span>        c1.key = c-&gt;key &amp;&amp; m-&gt;common.member_flags &amp; DDS_XTypes_IS_KEY;
<span class="linenos">337</span>        print_sample1_ti (p, &amp;m-&gt;common.member_type_id, &amp;c1, sep, *m-&gt;detail.name ? m-&gt;detail.name : NULL);
<span class="linenos">338</span>        sep = &quot;,&quot;;
<span class="linenos">339</span>      }
<span class="linenos">340</span>      printf (&quot;}&quot;);
<span class="linenos">341</span>      break;
<span class="linenos">342</span>    }
<span class="linenos">343</span>  }
<span class="linenos">344</span>}
<span class="linenos">345</span>
<span class="linenos">346</span>static void print_sample (bool valid_data, const void *sample, const DDS_XTypes_CompleteTypeObject *typeobj)
<span class="linenos">347</span>{
<span class="linenos">348</span>  struct context c1 = { .valid_data = valid_data, .key = true, .offset = 0, .maxalign = 1 };
<span class="linenos">349</span>  print_sample1_to (sample, typeobj, &amp;c1, &quot;&quot;, NULL);
<span class="linenos">350</span>  printf (&quot;\n&quot;);
<span class="linenos">351</span>}
<span class="linenos">352</span>
<span class="linenos">353</span>// Helper function to wait for a DCPSPublication to show up with the desired topic name, then calls
<span class="linenos">354</span>// dds_find_topic to create a topic for that data writer&#39;s type up the retrieves the type object.
<span class="linenos">355</span>static dds_return_t get_topic_and_typeobj (const char *topic_name, dds_duration_t timeout, dds_entity_t *topic, DDS_XTypes_TypeObject **xtypeobj)
<span class="linenos">356</span>{
<span class="linenos">357</span>  const dds_entity_t waitset = dds_create_waitset (participant);
<span class="linenos">358</span>  const dds_entity_t dcpspublication_reader = dds_create_reader (participant, DDS_BUILTIN_TOPIC_DCPSPUBLICATION, NULL, NULL);
<span class="linenos">359</span>  const dds_entity_t dcpspublication_readcond = dds_create_readcondition (dcpspublication_reader, DDS_ANY_STATE);
<span class="linenos">360</span>  (void) dds_waitset_attach (waitset, dcpspublication_readcond, 0);
<span class="linenos">361</span>  const dds_time_t abstimeout = (timeout == DDS_INFINITY) ? DDS_NEVER : dds_time () + timeout;
<span class="linenos">362</span>  dds_return_t ret = DDS_RETCODE_OK;
<span class="linenos">363</span>  *xtypeobj = NULL;
<span class="linenos">364</span>  while (*xtypeobj == NULL &amp;&amp; dds_waitset_wait_until (waitset, NULL, 0, abstimeout) &gt; 0)
<span class="linenos">365</span>  {
<span class="linenos">366</span>    void *epraw = NULL;
<span class="linenos">367</span>    dds_sample_info_t si;
<span class="linenos">368</span>    if (dds_take (dcpspublication_reader, &amp;epraw, &amp;si, 1, 1) &lt;= 0)
<span class="linenos">369</span>      continue;
<span class="linenos">370</span>    dds_builtintopic_endpoint_t *ep = epraw;
<span class="linenos">371</span>    const dds_typeinfo_t *typeinfo = NULL;
<span class="linenos">372</span>    // We are only interested in DCPSPublications where the topic name matches and that carry type information
<span class="linenos">373</span>    // (a non-XTypes capable DDS would not provide type information) because without that information there is
<span class="linenos">374</span>    // no way we can do anything interesting with it.
<span class="linenos">375</span>    if (strcmp (ep-&gt;topic_name, topic_name) == 0 &amp;&amp; dds_builtintopic_get_endpoint_type_info (ep, &amp;typeinfo) == 0 &amp;&amp; typeinfo)
<span class="linenos">376</span>    {
<span class="linenos">377</span>      // Using dds_find_topic allows us to &quot;clone&quot; the topic definition including the topic QoS, but it does
<span class="linenos">378</span>      // require that topic discovery is enabled in the configuration.  The advantage of using dds_find_topic
<span class="linenos">379</span>      // is that it creates a topic with the same name, type *and QoS*.  That distinction only matters if
<span class="linenos">380</span>      // topic is discovery is enabled and/or if the topic has a durability kind of of transient or persistent:
<span class="linenos">381</span>      // - using a different topic QoS might result in an incompatible QoS notification if topic discovery is
<span class="linenos">382</span>      //   enabled (everything would still work).
<span class="linenos">383</span>      // - transient/persistent data behaviour is defined in terms of the topic QoS actually really matters
<span class="linenos">384</span>      //
<span class="linenos">385</span>      // So we try to use dds_find_topic, and if that fails, try to go the other route using the writer&#39;s QoS
<span class="linenos">386</span>      // as an approximation of the topic QoS.
<span class="linenos">387</span>      if ((*topic = dds_find_topic (DDS_FIND_SCOPE_GLOBAL, participant, ep-&gt;topic_name, typeinfo, DDS_SECS (2))) &lt; 0)
<span class="linenos">388</span>      {
<span class="linenos">389</span>        fprintf (stderr, &quot;dds_find_topic: %s ... continuing on the assumptions that topic discovery is disabled\n&quot;, dds_strretcode (*topic));
<span class="linenos">390</span>        dds_topic_descriptor_t *descriptor;
<span class="linenos">391</span>        if ((ret = dds_create_topic_descriptor(DDS_FIND_SCOPE_GLOBAL, participant, typeinfo, DDS_SECS (10), &amp;descriptor)) &lt; 0)
<span class="linenos">392</span>        {
<span class="linenos">393</span>          fprintf (stderr, &quot;dds_create_topic_descriptor: %s\n&quot;, dds_strretcode (ret));
<span class="linenos">394</span>          dds_return_loan (dcpspublication_reader, &amp;epraw, 1);
<span class="linenos">395</span>          goto error;
<span class="linenos">396</span>        }
<span class="linenos">397</span>        if ((*topic = dds_create_topic (participant, descriptor, ep-&gt;topic_name, ep-&gt;qos, NULL)) &lt; 0)
<span class="linenos">398</span>        {
<span class="linenos">399</span>          fprintf (stderr, &quot;dds_create_topic_descriptor: %s (be sure to enable topic discovery in the configuration)\n&quot;, dds_strretcode (*topic));
<span class="linenos">400</span>          dds_delete_topic_descriptor (descriptor);
<span class="linenos">401</span>          dds_return_loan (dcpspublication_reader, &amp;epraw, 1);
<span class="linenos">402</span>          goto error;
<span class="linenos">403</span>        }
<span class="linenos">404</span>        dds_delete_topic_descriptor (descriptor);
<span class="linenos">405</span>      }
<span class="linenos">406</span>      // The topic suffices for creating a reader, but we also need the TypeObject to make sense of the data
<span class="linenos">407</span>      dds_typeobj_t *typeobj;
<span class="linenos">408</span>      DDS_XTypes_TypeInformation const * const xtypeinfo = (DDS_XTypes_TypeInformation *) typeinfo;
<span class="linenos">409</span>      if ((ret = dds_get_typeobj (participant, (const dds_typeid_t *) &amp;xtypeinfo-&gt;complete.typeid_with_size.type_id, 0, &amp;typeobj)) &lt; 0)
<span class="linenos">410</span>      {
<span class="linenos">411</span>        fprintf (stderr, &quot;dds_get_typeobj: %s\n&quot;, dds_strretcode (ret));
<span class="linenos">412</span>        dds_return_loan (dcpspublication_reader, &amp;epraw, 1);
<span class="linenos">413</span>        goto error;
<span class="linenos">414</span>      }
<span class="linenos">415</span>      *xtypeobj = (DDS_XTypes_TypeObject *) typeobj;
<span class="linenos">416</span>    }
<span class="linenos">417</span>    dds_return_loan (dcpspublication_reader, &amp;epraw, 1);
<span class="linenos">418</span>  }
<span class="linenos">419</span>  if (*xtypeobj)
<span class="linenos">420</span>  {
<span class="linenos">421</span>    // If we got the type object, populate the type cache
<span class="linenos">422</span>    size_t align, size;
<span class="linenos">423</span>    build_typecache_to (&amp;(*xtypeobj)-&gt;_u.complete, &amp;align, &amp;size);
<span class="linenos">424</span>    struct typeinfo templ = { .key = { .key = (uintptr_t) *xtypeobj } } , *info;
<span class="linenos">425</span>    if ((info = ddsrt_hh_lookup (typecache, &amp;templ)) != NULL)
<span class="linenos">426</span>    {
<span class="linenos">427</span>      assert (info-&gt;release == NULL);
<span class="linenos">428</span>      info-&gt;release = *xtypeobj;
<span class="linenos">429</span>    }
<span class="linenos">430</span>    else
<span class="linenos">431</span>    {
<span class="linenos">432</span>      // not sure whether this is at all possible
<span class="linenos">433</span>      info = malloc (sizeof (*info));
<span class="linenos">434</span>      *info = (struct typeinfo){ .key = { .key = (uintptr_t) *xtypeobj }, .typeobj = &amp;(*xtypeobj)-&gt;_u.complete, .release = *xtypeobj, .align = align, .size = size };
<span class="linenos">435</span>      ddsrt_hh_add (typecache, info);
<span class="linenos">436</span>    }
<span class="linenos">437</span>  }
<span class="linenos">438</span>error:
<span class="linenos">439</span>  dds_delete (dcpspublication_reader);
<span class="linenos">440</span>  dds_delete (waitset);
<span class="linenos">441</span>  return (*xtypeobj != NULL) ? DDS_RETCODE_OK : DDS_RETCODE_TIMEOUT;
<span class="linenos">442</span>}
<span class="linenos">443</span>
<span class="linenos">444</span>int main (int argc, char **argv)
<span class="linenos">445</span>{
<span class="linenos">446</span>  dds_return_t ret = 0;
<span class="linenos">447</span>  dds_entity_t topic = 0;
<span class="linenos">448</span>  
<span class="linenos">449</span>  if (argc != 2)
<span class="linenos">450</span>  {
<span class="linenos">451</span>    fprintf (stderr, &quot;usage: %s topicname\n&quot;, argv[0]);
<span class="linenos">452</span>    return 2;
<span class="linenos">453</span>  }
<span class="linenos">454</span>
<span class="linenos">455</span>  participant = dds_create_participant (DDS_DOMAIN_DEFAULT, NULL, NULL);
<span class="linenos">456</span>  if (participant &lt; 0)
<span class="linenos">457</span>  {
<span class="linenos">458</span>    fprintf (stderr, &quot;dds_create_participant: %s\n&quot;, dds_strretcode (participant));
<span class="linenos">459</span>    return 1;
<span class="linenos">460</span>  }
<span class="linenos">461</span>  
<span class="linenos">462</span>  // The one magic step: get a topic and type object ...
<span class="linenos">463</span>  DDS_XTypes_TypeObject *xtypeobj;
<span class="linenos">464</span>  typecache = ddsrt_hh_new (1, typecache_hash, typecache_equal);
<span class="linenos">465</span>  if ((ret = get_topic_and_typeobj (argv[1], DDS_SECS (10), &amp;topic, &amp;xtypeobj)) &lt; 0)
<span class="linenos">466</span>  {
<span class="linenos">467</span>    fprintf (stderr, &quot;get_topic_and_typeobj: %s\n&quot;, dds_strretcode (ret));
<span class="linenos">468</span>    goto error;
<span class="linenos">469</span>  }
<span class="linenos">470</span>  // ... given those, we can create a reader just like we do normally ...
<span class="linenos">471</span>  const dds_entity_t reader = dds_create_reader (participant, topic, NULL, NULL);
<span class="linenos">472</span>  // ... and create a waitset that allows us to wait for any incoming data ...
<span class="linenos">473</span>  const dds_entity_t waitset = dds_create_waitset (participant);
<span class="linenos">474</span>  const dds_entity_t readcond = dds_create_readcondition (reader, DDS_ANY_STATE);
<span class="linenos">475</span>  (void) dds_waitset_attach (waitset, readcond, 0);
<span class="linenos">476</span>  while (1)
<span class="linenos">477</span>  {
<span class="linenos">478</span>    (void) dds_waitset_wait (waitset, NULL, 0, DDS_INFINITY);
<span class="linenos">479</span>    void *raw = NULL;
<span class="linenos">480</span>    dds_sample_info_t si;
<span class="linenos">481</span>    if ((ret = dds_take (reader, &amp;raw, &amp;si, 1, 1)) &lt; 0)
<span class="linenos">482</span>      goto error;
<span class="linenos">483</span>    else if (ret != 0)
<span class="linenos">484</span>    {
<span class="linenos">485</span>      // ... that we then print
<span class="linenos">486</span>      print_sample (si.valid_data, raw, &amp;xtypeobj-&gt;_u.complete);
<span class="linenos">487</span>      if ((ret = dds_return_loan (reader, &amp;raw, 1)) &lt; 0)
<span class="linenos">488</span>        goto error;
<span class="linenos">489</span>    }
<span class="linenos">490</span>  }
<span class="linenos">491</span>
<span class="linenos">492</span> error:
<span class="linenos">493</span>  ddsrt_hh_enum (typecache, free_typeinfo, NULL);
<span class="linenos">494</span>  ddsrt_hh_free (typecache);
<span class="linenos">495</span>  dds_delete (participant);
<span class="linenos">496</span>  return ret &lt; 0;
<span class="linenos">497</span>}
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">variouspub_types.idl</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-omg-idl notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">struct</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nd">@key</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 6</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">struct</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">  </span><span class="kt">short</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>
<span class="linenos">10</span><span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"></span>
<span class="linenos">11</span><span class="p">};</span><span class="w"></span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="k">struct</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">14</span><span class="w">  </span><span class="n">A</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="linenos">15</span><span class="w">  </span><span class="kt">sequence</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span><span class="w"> </span><span class="n">ts</span><span class="p">;</span><span class="w"></span>
<span class="linenos">16</span><span class="p">};</span><span class="w"></span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="k">struct</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">19</span><span class="w">  </span><span class="n">B</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="linenos">20</span><span class="w">  </span><span class="nd">@key</span><span class="w"></span>
<span class="linenos">21</span><span class="w">  </span><span class="kt">short</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"></span>
<span class="linenos">22</span><span class="p">};</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">variouspub.c</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="linenos">  5</span>
<span class="linenos">  6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;dds/dds.h&quot;</span><span class="cp"></span>
<span class="linenos">  7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;variouspub_types.h&quot;</span><span class="cp"></span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">samples_a</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 10</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">A</span><span class="p">){</span><span class="w"> </span><span class="s">&quot;Mariken&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;Wie sidi, vrient?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 11</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">A</span><span class="p">){</span><span class="w"> </span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Een meester vol consten,&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 12</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">A</span><span class="p">){</span><span class="w"> </span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Nieuwers af falende, wes ic besta.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 13</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">A</span><span class="p">){</span><span class="w"> </span><span class="s">&quot;Mariken&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;&#39;t Comt mi alleleens met wien dat ick ga,&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 14</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">A</span><span class="p">){</span><span class="w"> </span><span class="s">&quot;Mariken&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;Also lief gae ic metten quaetsten als metten besten.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 15</span><span class="w">  </span><span class="nb">NULL</span><span class="w"></span>
<span class="linenos"> 16</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">samples_b</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 19</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">B</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Wildi u liefde te mi werts vesten,&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 20</span><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 21</span><span class="w">          </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},{</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 22</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">B</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ick sal u consten leeren sonder ghelijcke,&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 23</span><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 24</span><span class="w">          </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="mi">13</span><span class="p">},{</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">},{</span><span class="mi">23</span><span class="p">,</span><span class="mi">29</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 25</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">B</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Die seven vrie consten: rethorijcke, musijcke,&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 26</span><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 27</span><span class="w">          </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">31</span><span class="p">,</span><span class="mi">37</span><span class="p">},{</span><span class="mi">41</span><span class="p">,</span><span class="mi">43</span><span class="p">},{</span><span class="mi">47</span><span class="p">,</span><span class="mi">52</span><span class="p">},{</span><span class="mi">59</span><span class="p">,</span><span class="mi">61</span><span class="p">},{</span><span class="mi">67</span><span class="p">,</span><span class="mi">71</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 28</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">B</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Logica, gramatica ende geometrie,&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 29</span><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 30</span><span class="w">          </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">73</span><span class="p">,</span><span class="mi">79</span><span class="p">},{</span><span class="mi">83</span><span class="p">,</span><span class="mi">89</span><span class="p">},{</span><span class="mi">97</span><span class="p">,</span><span class="mi">101</span><span class="p">},{</span><span class="mi">103</span><span class="p">,</span><span class="mi">107</span><span class="p">},{</span><span class="mi">109</span><span class="p">,</span><span class="mi">113</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 31</span><span class="w">                            </span><span class="p">{</span><span class="mi">127</span><span class="p">,</span><span class="mi">131</span><span class="p">},{</span><span class="mi">137</span><span class="p">,</span><span class="mi">139</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 32</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">B</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Aristmatica ende alkenie,&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 33</span><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 34</span><span class="w">          </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">149</span><span class="p">,</span><span class="mi">151</span><span class="p">},{</span><span class="mi">157</span><span class="p">,</span><span class="mi">163</span><span class="p">},{</span><span class="mi">167</span><span class="p">,</span><span class="mi">173</span><span class="p">},{</span><span class="mi">179</span><span class="p">,</span><span class="mi">181</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 35</span><span class="w">                            </span><span class="p">{</span><span class="mi">191</span><span class="p">,</span><span class="mi">193</span><span class="p">},{</span><span class="mi">197</span><span class="p">,</span><span class="w"> </span><span class="mi">199</span><span class="p">},{</span><span class="mi">211</span><span class="p">,</span><span class="mi">223</span><span class="p">},{</span><span class="mi">227</span><span class="p">,</span><span class="mi">229</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 36</span><span class="w">                            </span><span class="p">{</span><span class="mi">233</span><span class="p">,</span><span class="mi">239</span><span class="p">},{</span><span class="mi">241</span><span class="p">,</span><span class="mi">251</span><span class="p">},{</span><span class="mi">257</span><span class="p">,</span><span class="mi">263</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 37</span><span class="w">  </span><span class="nb">NULL</span><span class="w"></span>
<span class="linenos"> 38</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">samples_c</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 41</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">C</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dwelc al consten sijn seer curable.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 42</span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 43</span><span class="w">            </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">269</span><span class="p">,</span><span class="mi">271</span><span class="p">},{</span><span class="mi">277</span><span class="p">,</span><span class="mi">281</span><span class="p">},{</span><span class="mi">283</span><span class="p">,</span><span class="mi">293</span><span class="p">},{</span><span class="mi">307</span><span class="p">,</span><span class="mi">311</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 44</span><span class="w">                              </span><span class="p">{</span><span class="mi">313</span><span class="p">,</span><span class="mi">317</span><span class="p">},{</span><span class="mi">331</span><span class="p">,</span><span class="mi">337</span><span class="p">},{</span><span class="mi">347</span><span class="p">,</span><span class="mi">349</span><span class="p">},{</span><span class="mi">353</span><span class="p">,</span><span class="mi">359</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 45</span><span class="w">                              </span><span class="p">{</span><span class="mi">367</span><span class="p">,</span><span class="mi">373</span><span class="p">},{</span><span class="mi">379</span><span class="p">,</span><span class="mi">383</span><span class="p">},{</span><span class="mi">389</span><span class="p">,</span><span class="mi">397</span><span class="p">},{</span><span class="mi">401</span><span class="p">,</span><span class="mi">409</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 46</span><span class="w">                              </span><span class="p">{</span><span class="mi">419</span><span class="p">,</span><span class="mi">421</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 47</span><span class="w">        </span><span class="mi">8936</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 48</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">C</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Noyt vrouwe en leefde op eerde so able&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 49</span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 50</span><span class="w">            </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">431</span><span class="p">,</span><span class="mi">433</span><span class="p">},{</span><span class="mi">439</span><span class="p">,</span><span class="mi">443</span><span class="p">},{</span><span class="mi">449</span><span class="p">,</span><span class="mi">457</span><span class="p">},{</span><span class="mi">461</span><span class="p">,</span><span class="mi">463</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 51</span><span class="w">                              </span><span class="p">{</span><span class="mi">467</span><span class="p">,</span><span class="mi">479</span><span class="p">},{</span><span class="mi">487</span><span class="p">,</span><span class="mi">491</span><span class="p">},{</span><span class="mi">499</span><span class="p">,</span><span class="mi">503</span><span class="p">},{</span><span class="mi">509</span><span class="p">,</span><span class="mi">521</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 52</span><span class="w">                              </span><span class="p">{</span><span class="mi">523</span><span class="p">,</span><span class="mi">541</span><span class="p">},{</span><span class="mi">547</span><span class="p">,</span><span class="mi">557</span><span class="p">},{</span><span class="mi">563</span><span class="p">,</span><span class="mi">569</span><span class="p">},{</span><span class="mi">571</span><span class="p">,</span><span class="mi">577</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 53</span><span class="w">                              </span><span class="p">{</span><span class="mi">587</span><span class="p">,</span><span class="mi">593</span><span class="p">},{</span><span class="mi">599</span><span class="p">,</span><span class="mi">601</span><span class="p">},{</span><span class="mi">607</span><span class="p">,</span><span class="mi">613</span><span class="p">},{</span><span class="mi">617</span><span class="p">,</span><span class="mi">619</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 54</span><span class="w">                              </span><span class="p">{</span><span class="mi">631</span><span class="p">,</span><span class="mi">641</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 55</span><span class="w">        </span><span class="mi">18088</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 56</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">C</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Die duvel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Als ic u maken sal.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 57</span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 58</span><span class="w">            </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">643</span><span class="p">,</span><span class="mi">647</span><span class="p">},{</span><span class="mi">653</span><span class="p">,</span><span class="mi">659</span><span class="p">},{</span><span class="mi">661</span><span class="p">,</span><span class="mi">673</span><span class="p">},{</span><span class="mi">677</span><span class="p">,</span><span class="mi">683</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 59</span><span class="w">                              </span><span class="p">{</span><span class="mi">691</span><span class="p">,</span><span class="mi">701</span><span class="p">},{</span><span class="mi">709</span><span class="p">,</span><span class="mi">719</span><span class="p">},{</span><span class="mi">727</span><span class="p">,</span><span class="mi">733</span><span class="p">},{</span><span class="mi">739</span><span class="p">,</span><span class="mi">743</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 60</span><span class="w">                              </span><span class="p">{</span><span class="mi">751</span><span class="p">,</span><span class="mi">757</span><span class="p">},{</span><span class="mi">761</span><span class="p">,</span><span class="mi">769</span><span class="p">},{</span><span class="mi">773</span><span class="p">,</span><span class="mi">787</span><span class="p">},{</span><span class="mi">797</span><span class="p">,</span><span class="mi">809</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 61</span><span class="w">                              </span><span class="p">{</span><span class="mi">811</span><span class="p">,</span><span class="mi">821</span><span class="p">},{</span><span class="mi">823</span><span class="p">,</span><span class="mi">827</span><span class="p">},{</span><span class="mi">829</span><span class="p">,</span><span class="mi">839</span><span class="p">},{</span><span class="mi">853</span><span class="p">,</span><span class="mi">857</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 62</span><span class="w">                              </span><span class="p">{</span><span class="mi">859</span><span class="p">,</span><span class="mi">863</span><span class="p">},{</span><span class="mi">877</span><span class="p">,</span><span class="mi">881</span><span class="p">},{</span><span class="mi">883</span><span class="p">,</span><span class="mi">887</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 63</span><span class="w">        </span><span class="mi">29172</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 64</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">C</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Mariken&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;So moetti wel zijn een constich man.&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 65</span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 66</span><span class="w">            </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">907</span><span class="p">,</span><span class="mi">911</span><span class="p">},{</span><span class="mi">919</span><span class="p">,</span><span class="mi">929</span><span class="p">},{</span><span class="mi">937</span><span class="p">,</span><span class="mi">941</span><span class="p">},{</span><span class="mi">947</span><span class="p">,</span><span class="mi">953</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 67</span><span class="w">                              </span><span class="p">{</span><span class="mi">967</span><span class="p">,</span><span class="mi">971</span><span class="p">},{</span><span class="mi">977</span><span class="p">,</span><span class="mi">983</span><span class="p">},{</span><span class="mi">991</span><span class="p">,</span><span class="mi">997</span><span class="p">},{</span><span class="mi">1009</span><span class="p">,</span><span class="mi">1013</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 68</span><span class="w">                              </span><span class="p">{</span><span class="mi">1019</span><span class="p">,</span><span class="mi">1021</span><span class="p">},{</span><span class="mi">1031</span><span class="p">,</span><span class="mi">1033</span><span class="p">},{</span><span class="mi">1039</span><span class="p">,</span><span class="mi">1049</span><span class="p">},{</span><span class="mi">1051</span><span class="p">,</span><span class="mi">1061</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 69</span><span class="w">                              </span><span class="p">{</span><span class="mi">1063</span><span class="p">,</span><span class="mi">1069</span><span class="p">},{</span><span class="mi">1087</span><span class="p">,</span><span class="mi">1091</span><span class="p">},{</span><span class="mi">1093</span><span class="p">,</span><span class="mi">1097</span><span class="p">},{</span><span class="mi">1103</span><span class="p">,</span><span class="mi">1109</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 70</span><span class="w">                              </span><span class="p">{</span><span class="mi">1117</span><span class="p">,</span><span class="mi">1123</span><span class="p">},{</span><span class="mi">1129</span><span class="p">,</span><span class="mi">1151</span><span class="p">},{</span><span class="mi">1153</span><span class="p">,</span><span class="mi">1163</span><span class="p">},{</span><span class="mi">1171</span><span class="p">,</span><span class="mi">1181</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 71</span><span class="w">                              </span><span class="p">{</span><span class="mi">1187</span><span class="p">,</span><span class="mi">1193</span><span class="p">},{</span><span class="mi">1201</span><span class="p">,</span><span class="mi">1213</span><span class="p">},{</span><span class="mi">1217</span><span class="p">,</span><span class="mi">1223</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 72</span><span class="w">        </span><span class="mi">16022</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 73</span><span class="w">  </span><span class="o">&amp;</span><span class="p">(</span><span class="n">C</span><span class="p">){</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Mariken&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;Wie sidi dan?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 74</span><span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">_release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 75</span><span class="w">            </span><span class="p">.</span><span class="n">_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]){</span><span class="w"> </span><span class="p">{</span><span class="mi">1229</span><span class="p">,</span><span class="mi">1231</span><span class="p">},{</span><span class="mi">1237</span><span class="p">,</span><span class="mi">1249</span><span class="p">},{</span><span class="mi">1259</span><span class="p">,</span><span class="mi">1277</span><span class="p">},{</span><span class="mi">1279</span><span class="p">,</span><span class="mi">1283</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 76</span><span class="w">                              </span><span class="p">{</span><span class="mi">1289</span><span class="p">,</span><span class="mi">1291</span><span class="p">},{</span><span class="mi">1297</span><span class="p">,</span><span class="mi">1301</span><span class="p">},{</span><span class="mi">1303</span><span class="p">,</span><span class="mi">1307</span><span class="p">},{</span><span class="mi">1319</span><span class="p">,</span><span class="mi">1321</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 77</span><span class="w">                              </span><span class="p">{</span><span class="mi">1327</span><span class="p">,</span><span class="mi">1361</span><span class="p">},{</span><span class="mi">1367</span><span class="p">,</span><span class="mi">1373</span><span class="p">},{</span><span class="mi">1381</span><span class="p">,</span><span class="mi">1399</span><span class="p">},{</span><span class="mi">1409</span><span class="p">,</span><span class="mi">1423</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 78</span><span class="w">                              </span><span class="p">{</span><span class="mi">1427</span><span class="p">,</span><span class="mi">1429</span><span class="p">},{</span><span class="mi">1433</span><span class="p">,</span><span class="mi">1439</span><span class="p">},{</span><span class="mi">1447</span><span class="p">,</span><span class="mi">1451</span><span class="p">},{</span><span class="mi">1453</span><span class="p">,</span><span class="mi">1459</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 79</span><span class="w">                              </span><span class="p">{</span><span class="mi">1471</span><span class="p">,</span><span class="mi">1481</span><span class="p">},{</span><span class="mi">1483</span><span class="p">,</span><span class="mi">1487</span><span class="p">},{</span><span class="mi">1489</span><span class="p">,</span><span class="mi">1493</span><span class="p">},{</span><span class="mi">1499</span><span class="p">,</span><span class="mi">1511</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 80</span><span class="w">                              </span><span class="p">{</span><span class="mi">1523</span><span class="p">,</span><span class="mi">1531</span><span class="p">},{</span><span class="mi">1543</span><span class="p">,</span><span class="mi">1549</span><span class="p">},{</span><span class="mi">1553</span><span class="p">,</span><span class="mi">1559</span><span class="p">},{</span><span class="mi">1567</span><span class="p">,</span><span class="mi">1571</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 81</span><span class="w">                              </span><span class="p">{</span><span class="mi">1579</span><span class="p">,</span><span class="mi">1583</span><span class="p">},{</span><span class="mi">1597</span><span class="p">,</span><span class="mi">1601</span><span class="p">},{</span><span class="mi">1607</span><span class="p">,</span><span class="mi">1609</span><span class="p">},{</span><span class="mi">1613</span><span class="p">,</span><span class="mi">1619</span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 82</span><span class="w">                              </span><span class="p">{</span><span class="mi">1621</span><span class="p">,</span><span class="mi">1627</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 83</span><span class="w">        </span><span class="mi">17880</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 84</span><span class="w">  </span><span class="nb">NULL</span><span class="w"></span>
<span class="linenos"> 85</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tpentry</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 88</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 89</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_topic_descriptor_t</span><span class="w"> </span><span class="o">*</span><span class="n">descr</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 90</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">samples</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 91</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count_offset</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 92</span><span class="p">}</span><span class="w"> </span><span class="n">tptab</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 93</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">A_desc</span><span class="p">,</span><span class="w"> </span><span class="n">samples_a</span><span class="p">,</span><span class="w"> </span><span class="n">offsetof</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 94</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">B_desc</span><span class="p">,</span><span class="w"> </span><span class="n">samples_b</span><span class="p">,</span><span class="w"> </span><span class="n">offsetof</span><span class="w"> </span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 95</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">C_desc</span><span class="p">,</span><span class="w"> </span><span class="n">samples_c</span><span class="p">,</span><span class="w"> </span><span class="n">offsetof</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos"> 96</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 97</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">usage</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">100</span><span class="p">{</span><span class="w"></span>
<span class="linenos">101</span><span class="w">  </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;usage: %s {&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv0</span><span class="p">);</span><span class="w"></span>
<span class="linenos">102</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">103</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">tpentry</span><span class="w"> </span><span class="o">*</span><span class="n">tpentry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tptab</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="n">tpentry</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">104</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos">105</span><span class="w">    </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="p">,</span><span class="w"> </span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="linenos">106</span><span class="w">    </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">107</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">108</span><span class="w">  </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">109</span><span class="w">  </span><span class="n">exit</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="linenos">110</span><span class="p">}</span><span class="w"></span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="linenos">113</span><span class="p">{</span><span class="w"></span>
<span class="linenos">114</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">115</span><span class="w">    </span><span class="n">usage</span><span class="w"> </span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="linenos">116</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">tpentry</span><span class="w"> </span><span class="o">*</span><span class="n">tpentry</span><span class="p">;</span><span class="w"></span>
<span class="linenos">117</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">tpentry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tptab</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="n">tpentry</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">118</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="w"> </span><span class="p">(</span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">119</span><span class="w">      </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="linenos">120</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"></span>
<span class="linenos">121</span><span class="w">    </span><span class="n">usage</span><span class="w"> </span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="linenos">122</span>
<span class="linenos">123</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">participant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_participant</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_DOMAIN_DEFAULT</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">124</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">125</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos">126</span><span class="w">    </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dds_create_participant: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dds_strretcode</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">));</span><span class="w"></span>
<span class="linenos">127</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">128</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">129</span>
<span class="linenos">130</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_topic</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">descr</span><span class="p">,</span><span class="w"> </span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">131</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dds_entity_t</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_create_writer</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="linenos">132</span><span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">sample_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">133</span><span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">134</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">135</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos">136</span><span class="w">    </span><span class="n">dds_return_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">137</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">samples</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">];</span><span class="w"></span>
<span class="linenos">138</span><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">countp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">count_offset</span><span class="p">);</span><span class="w"></span>
<span class="linenos">139</span><span class="w">    </span><span class="o">*</span><span class="n">countp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="linenos">140</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds_write</span><span class="w"> </span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="n">sample</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">141</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">142</span><span class="w">      </span><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dds_write: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dds_strretcode</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">));</span><span class="w"></span>
<span class="linenos">143</span><span class="w">      </span><span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span><span class="w"></span>
<span class="linenos">144</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">145</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">146</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tpentry</span><span class="o">-&gt;</span><span class="n">samples</span><span class="p">[</span><span class="o">++</span><span class="n">sample_idx</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"></span>
<span class="linenos">147</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">148</span><span class="w">      </span><span class="n">sample_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">149</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">150</span><span class="w">    </span><span class="n">dds_sleepfor</span><span class="w"> </span><span class="p">(</span><span class="n">DDS_SECS</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="linenos">151</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">152</span>
<span class="linenos">153</span><span class="w">  </span><span class="n">dds_delete</span><span class="w"> </span><span class="p">(</span><span class="n">participant</span><span class="p">);</span><span class="w"></span>
<span class="linenos">154</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">155</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon"><</span><span>Page contents<span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">></span><span>Page contents:<span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">dynsub</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#running-the-example">Running the example</a></li>
<li><a class="reference internal" href="#source-code">Source code</a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="listtopics.html">
                    <span class="icon"><</span><span>listtopics</span></a>
                
            </div>

            <div class="right">
                
                    <a href="../security.html"><span>DDS Security</span><span class="icon">></span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Eclipse Cyclone DDS committers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>